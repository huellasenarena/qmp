Claro ğŸ™‚. AquÃ­ tienes un **resumen limpio, completo y pegable**, pensado para **abrir un nuevo hilo sin fricciÃ³n**, con todo el estado actual, las decisiones tomadas y las ideas futuras claras.

---

# ğŸ“˜ PROYECTO QMP â€” RESUMEN GENERAL (para nuevo hilo)

## ğŸ¯ Objetivo

Mantener un **sitio poÃ©tico diario** con una experiencia editorial cuidada, donde:

* se publica **un poema propio** + **un anÃ¡lisis de un poema ajeno** por dÃ­a,
* el archivo es navegable, filtrable y legible,
* el flujo de publicaciÃ³n es **rÃ¡pido, seguro y reversible**,
* el humano decide el contenido; el sistema valida y publica.

No hay CMS, no hay heurÃ­sticas creativas automÃ¡ticas, no hay dependencias innecesarias.

---

## ğŸ§± Arquitectura del proyecto

```
qmp/
â”œâ”€â”€ index.html
â”œâ”€â”€ archivo.html
â”œâ”€â”€ passe.html
â”œâ”€â”€ style.css
â”œâ”€â”€ script.js
â”œâ”€â”€ archivo.json              # Ã­ndice Ãºnico del sitio
â”œâ”€â”€ textos/
â”‚   â”œâ”€â”€ YYYY-MM-DD.txt        # texto diario (poema + cita + anÃ¡lisis)
â”‚   â””â”€â”€ templateTEXT.txt
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ qd.sh
â”‚   â”œâ”€â”€ qk.sh
â”‚   â”œâ”€â”€ qmp_publish.sh
â”‚   â”œâ”€â”€ make_pending_entry.py
â”‚   â”œâ”€â”€ merge_pending.py
â”‚   â”œâ”€â”€ gptapi.py             # genera keywords vÃ­a OpenAI
â”‚   â”œâ”€â”€ pending_keywords.txt  # keywords activas (editables)
â”‚   â””â”€â”€ keywords_backups/     # backups por fecha
â”‚       â””â”€â”€ YYYY-MM-DD.json
â””â”€â”€ logs/
    â””â”€â”€ publish_log.jsonl     # historial append-only de publicaciones
```

SeparaciÃ³n estricta:

* **contenido** â†’ `textos/*.txt`
* **datos** â†’ `archivo.json`
* **presentaciÃ³n** â†’ HTML/CSS
* **lÃ³gica** â†’ JS + scripts
* **automatizaciÃ³n** â†’ shell + Python

---

## âœï¸ Flujo de trabajo diario (actual)

### 1ï¸âƒ£ Preparar el dÃ­a

```bash
qd YYYY-MM-DD
# o simplemente:
qd
```

* crea `textos/YYYY-MM-DD.txt` desde plantilla si no existe,
* abre el archivo para escribir,
* no toca keywords, git ni `archivo.json`.

---

### 2ï¸âƒ£ Generar palabras clave (opcional, pero habitual)

```bash
qk YYYY-MM-DD
# o:
qk
```

* llama a `scripts/gptapi.py`,
* usa **OpenAI (gpt-5-mini)**,
* genera keywords en:

  * `scripts/pending_keywords.txt` (activo),
  * `scripts/keywords_backups/YYYY-MM-DD.json` (histÃ³rico),
* no toca `archivo.json`,
* no hace commit.

Las keywords:

* pueden ser de **una o varias palabras**,
* vienen en formato JSON `{word, weight}`,
* siguen reglas editoriales claras (POEMA manda, anÃ¡lisis no impone).

---

### 3ï¸âƒ£ Validar sin riesgo

```bash
q --dry-run YYYY-MM-DD
# o:
qdk YYYY-MM-DD   # (qk + dry-run en un solo paso)
```

* genera `pending_entry.json`,
* valida estructura, texto y keywords,
* muestra el mensaje de commit,
* **no** toca git ni publica nada.

---

### 4ï¸âƒ£ Publicar

```bash
q YYYY-MM-DD
# o:
q
```

* hace **upsert** en `archivo.json` (nuevo o ediciÃ³n),
* aÃ±ade entrada a `logs/publish_log.jsonl`,
* commit automÃ¡tico + push a GitHub,
* borra `pending_entry.json`.

ğŸ‘‰ **Ãšnico paso irreversible.**

---

## ğŸ§  Sitio web â€” comportamiento clave

### `index.html`

* muestra el **dÃ­a actual segÃºn el visitante**,
* alterna *Poema du jour* / *Analyse du jour*,
* flecha (fecha) visible a la derecha del nav,
* **no muestra futuro**.

### `archivo.html`

* muestra **solo el pasado** (hasta ayer del visitante),
* filtros por:

  * mes,
  * autor,
  * bÃºsqueda libre,
* bÃºsqueda avanzada:

  * soporta **frases multi-palabra**,
  * AND semÃ¡ntico,
  * scoring por keywords + metadatos,
* no aparecen meses ni autores futuros.

### `passe.html`

* muestra un dÃ­a pasado vÃ­a `?date=YYYY-MM-DD`,
* misma lÃ³gica que index,
* enlace claro para volver al presente.

---

## âœ’ï¸ ConvenciÃ³n tipogrÃ¡fica especial (poesÃ­a)

En los `.txt`:

```txt
por |el dinero
|el cansancio
y ||la falta de tiempo
```

* `|` define una columna de alineaciÃ³n,
* `|` al inicio = continuaciÃ³n alineada,
* `||` = continuaciÃ³n alineada **con prefijo visible**,
* mediciÃ³n real con `canvas.measureText`.

---

## ğŸ·ï¸ Keywords (editorial + tÃ©cnica)

* Generadas con `gpt-5-mini`, `reasoning="low"`,
* `max_output_tokens=1000` (estable en textos largos),
* frases multi-palabra permitidas,
* normalizadas (minÃºsculas, sin acentos),
* pesos:

  * `3` â†’ nÃºcleo conceptual (POEMA),
  * `2` â†’ dinÃ¡micas/tensiones,
  * `1` â†’ campo semÃ¡ntico/figuras.

Backups por fecha en `scripts/keywords_backups/`.

---

## ğŸ“œ Log de publicaciones

`logs/publish_log.jsonl` (append-only):

```json
{
  "date": "2026-01-02",
  "file": "textos/2026-01-02.txt",
  "title": "â€¦",
  "keywords": 24,
  "timestamp": "2026-01-02T01:23:45Z"
}
```

Sirve para:

* historial real,
* debugging,
* estadÃ­sticas futuras,
* posibles pÃ¡ginas derivadas.

---

## ğŸ§  FilosofÃ­a del sistema

* El humano escribe y decide.
* El sistema valida, ensambla y publica.
* Un solo gesto publica (`q`).
* Editar el pasado es tan natural como publicar hoy.
* Nada se publica sin verse antes.
* CÃ³digo explÃ­cito > heurÃ­sticas.
* Legibilidad > automatismo.

---

## ğŸ”® Ideas futuras (no implementadas aÃºn)

* Integrar `qk` opcional dentro de `q --dry-run`,
* retry automÃ¡tico de keywords (`mini â†’ minimal`) solo si falla,
* estadÃ­sticas desde `publish_log.jsonl`,
* ejecuciÃ³n del pipeline vÃ­a GitHub Actions (publicar desde iPad),
* visualizaciÃ³n del â€œhistorial de ediciÃ³nâ€ por dÃ­a.

---

Este resumen refleja **el estado actual real** del proyecto.
Puedes pegarlo tal cual en un nuevo hilo y continuar sin pÃ©rdida de contexto.
